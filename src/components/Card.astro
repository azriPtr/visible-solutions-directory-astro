---
interface Props {
  title?: string;
  description?: string;

  variant?: "default" | "review" | "article" | "service" | "location";

  number?: string;
  prosCount?: string; // For location cards (e.g., "342+ PROS")
  image?: string;
  imageAlt?: string;
  rating?: number;
  author?: string;
  authorImage?: string;
  date?: string;
  category?: string;

  linkUrl?: string;
  linkText?: string;

  class?: string;
}

const {
  title,
  description,
  variant = "default",
  number,
  prosCount,
  image,
  imageAlt,
  rating,
  author,
  authorImage,
  date,
  category,
  linkUrl,
  linkText,
  class: className = "",
} = Astro.props;

const showLink = linkUrl && linkText;

const stars =
  rating !== undefined ? Array.from({ length: 5 }, (_, i) => i < rating) : [];
---

<li
  class={`group relative flex flex-col rounded-lg border border-base-200 bg-white shadow-sm transition-all hover:-translate-y-1 hover:shadow-md ${className}`}>
  <!-- Overlay Number (for location variant) -->
  {variant === "location" && number && (
    <span class="absolute top-4 right-4 text-6xl font-bold text-base-200/30 pointer-events-none">
      {number}
    </span>
  )}

  <!-- Image -->
  {
    image && (
      <div class="overflow-hidden rounded-t-lg">
        <img
          src={image}
          alt={imageAlt || title}
          class="h-48 w-full object-cover transition-transform duration-300 group-hover:scale-105"
          loading="lazy"
        />
      </div>
    )
  }

  <div class={`flex flex-col flex-1 p-6`}>
    {variant === "review" ? (
      <!-- Review Variant Layout !-->
      <>
        <!-- Rating (at top for reviews) -->
        {
          rating !== undefined && (
            <div class="mb-4 flex items-center gap-1">
              {stars.map((isFilled) => (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill={isFilled ? "currentColor" : "none"}
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class={isFilled ? "text-secondary" : "text-base-300"}>
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                </svg>
              ))}
            </div>
          )
        }

        <!-- Review Text (quoted) -->
        {
          description && (
            <blockquote class="mb-4 flex-1 text-base text-base-content leading-relaxed">
              "{description}"
            </blockquote>
          )
        }

        <!-- Separator -->
        {category && <hr class="mb-4 border-base-200" />}

        <!-- Category/Location Tag (at bottom for reviews) -->
        {
          category && (
            <span class="text-xs font-medium uppercase tracking-wide text-base-300">
              {category}
            </span>
          )
        }
      </>
    ) : variant === "location" ? (
      <!-- Location Variant Layout -->
      <>
        <!-- Title (City Name) -->
        {title && (
          <h3 class="mb-2 text-lg font-bold text-primary">{title}</h3>
        )}

        <!-- Pros Count -->
        {
          prosCount && (
            <span class="mb-3 text-sm font-semibold text-secondary">{prosCount}</span>
          )
        }

        <!-- Description -->
        {
          description && (
            <p class="mb-6 flex-1 text-sm text-base-300">{description}</p>
          )
        }

        <!-- Link/CTA -->
        {
          showLink && (
            <a
              href={linkUrl}
              class="inline-flex items-center text-sm font-bold text-secondary mt-auto">
              {linkText}
              <svg
                class="ml-1 h-4 w-4"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M5 12h14m-7-7 7 7-7 7" />
              </svg>
            </a>
          )
        }
      </>
    ) : (
      <!-- Default/Other Variants Layout -->
      <>
        <!-- Category/Tag (for articles) -->
        {
          category && (
            <span class="badge badge-soft badge-primary bg-surface inline-flex items-center rounded-md bg-base-100 px-2 py-2 mb-2 shadow-sm font-semibold text-sm">
              {category}
            </span>
          )
        }

        <!-- Number (for services) -->
        {
          number && (
            <span class="mb-4 text-xl font-bold text-base-200">{number}</span>
          )
        }

        <!-- Rating (for other variants) -->
        {
          rating !== undefined && (
            <div class="mb-3 flex items-center gap-1 text-secondary">
              {stars.map((isFilled) => (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill={isFilled ? "currentColor" : "none"}
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class={isFilled ? "text-secondary" : "text-base-300"}>
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                </svg>
              ))}
            </div>
          )
        }

        <!-- Title -->
        {title && (
          <h3 class="mb-3 text-lg font-bold text-primary">{title}</h3>
        )}

        <!-- Description -->
        {
          description && (
            <p class="mb-6 flex-1 text-sm text-base-300">{description}</p>
          )
        }

        <!-- Author & Date (for articles/reviews) -->
        {
          (author || date) && (
            <div class="mb-4 flex items-center gap-3">
              {authorImage && (
                <img
                  src={authorImage}
                  alt={author || "Author"}
                  class="h-10 w-10 rounded-full object-cover"
                  loading="lazy"
                />
              )}
              <div class="flex flex-col">
                {author && (
                  <span class="text-sm font-semibold text-base-content">
                    {author}
                  </span>
                )}
                {date && <span class="text-xs text-base-300">{date}</span>}
              </div>
            </div>
          )
        }

        <!-- Link/CTA -->
        {
          showLink && (
            <a
              href={linkUrl}
              class="inline-flex items-center text-sm font-bold text-secondary mt-auto">
              {linkText}
              <svg
                class="ml-1 h-4 w-4"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round">
                <path d="M5 12h14m-7-7 7 7-7 7" />
              </svg>
            </a>
          )
        }
      </>
    )}
  </div>
</li>
