---
interface Props {
  title: string;
  description?: string;
  breadcrumbs?: Array<{ label: string; href?: string }>;
}

const { title, description, breadcrumbs: manualBreadcrumbs } = Astro.props;

/**
 * Generates breadcrumbs from a URL pathname.
 * Converts path segments into readable labels and builds navigation paths.
 *
 * @param pathname - The URL pathname (e.g., "/partners" or "/locksmiths/brum-city-security")
 * @returns Array of breadcrumb objects with label and optional href
 */
function generateBreadcrumbs(
  pathname: string
): Array<{ label: string; href?: string }> {
  type Breadcrumb = { label: string; href?: string };

  /* Converts "brum-city-security" â†’ "Brum City Security" */
  function formatSegmentLabel(segment: string): string {
    return segment
      .split("-")
      .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
      .join(" ");
  }

  const pathSegments = pathname.split("/").filter(Boolean);
  const breadcrumbs: Breadcrumb[] = [{ label: "Home", href: "/" }];

  // Early return if pathname is root or empty
  if (pathSegments.length === 0) {
    return breadcrumbs;
  }

  let accumulatedPath = "";
  pathSegments.forEach((segment, index) => {
    accumulatedPath += `/${segment}`;
    const isLastSegment = index === pathSegments.length - 1;

    breadcrumbs.push({
      label: formatSegmentLabel(segment),
      href: isLastSegment ? undefined : accumulatedPath,
    });
  });

  return breadcrumbs;
}

// Use manual breadcrumbs if provided, otherwise auto-generate from URL
const breadcrumbs =
  manualBreadcrumbs || generateBreadcrumbs(Astro.url.pathname);
---

<section class="py-12">
  <!-- Breadcrumb -->
  <nav aria-label="Breadcrumb" class="mb-8 px-6">
    <ol class="flex items-center gap-2 text-sm">
      {
        breadcrumbs.map((crumb, index) => (
          <li class="flex items-center gap-2">
            {crumb.href ? (
              <a href={crumb.href} class="text-primary hover:underline">
                {crumb.label}
              </a>
            ) : (
              <span aria-current="page" class="font-medium text-base-content">
                {crumb.label}
              </span>
            )}
            {index < breadcrumbs.length - 1 && (
              <span class="text-base-content/50" aria-hidden="true">
                /
              </span>
            )}
          </li>
        ))
      }
    </ol>
  </nav>

  <!-- Title and Description -->
  <div class="mb-12">
    <h1 class="mb-6 text-4xl font-bold text-primary">
      {title}
    </h1>

    {
      description && (
        <p class="mb-6 max-w-3xl text-base leading-relaxed text-base-content/80">
          {description}
        </p>
      )
    }

    <!-- Slot for additional content like info boxes, buttons, etc. -->
    <slot />
  </div>
</section>
