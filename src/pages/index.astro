---
import HeroSection from "../components/HeroSection.astro";
import Layout from "../layouts/Layout.astro";
import AiSection from "../components/AiSection.astro";
import ContentSection from "../components/ContentSection.astro";
import ReviewSection from "../components/ReviewSection.astro";
import SubscribeSection from "../components/SubscribeSection.astro";
import VerifiedSection from "../components/VerifiedSection.astro";
import FAQ from "../components/FAQ.astro";

import {
  seo,
  servicesSection,
  locationsSection,
  articlesSection,
} from "../data/homepage";
import { getHomepageServices } from "../data/services/index";
import { getHomepageLocations } from "../data/locations";
import { getCollection } from "astro:content";

const seoData = seo;

// Services from data layer
const servicesData = getHomepageServices();
const services = servicesData.map((service) => ({
  variant: "service" as const,
  number: "",
  title: service.title,
  description: service.description,
  linkUrl: `/services/${service.slug}`,
  linkText: service.ctaText,
}));

// Locations from data layer
const locationsData = getHomepageLocations();
const locations = locationsData.map((location) => ({
  variant: "location" as const,
  ...location,
}));

// Articles from content collections (editorial content - stays in .md)
const articlesData = await getCollection("articles");
const articles = articlesData.map((entry) => ({
  variant: "article" as const,
  ...entry.data,
  image: entry.data.image.src,
}));
---

<Layout {...seoData}>
  <HeroSection />
  <AiSection />
  <ContentSection
    title={servicesSection.title}
    description={servicesSection.description}
    items={services}
    viewAllText={servicesSection.viewAllText}
    viewAllUrl={servicesSection.viewAllUrl}
    columns="4"
  />
  <ReviewSection />
  <ContentSection
    title={locationsSection.title}
    description={locationsSection.description}
    items={locations}
    viewAllText={locationsSection.viewAllText}
    viewAllUrl={locationsSection.viewAllUrl}
    columns="4"
    cardVariant="location"
  />
  <SubscribeSection />
  <ContentSection
    title={articlesSection.title}
    description={articlesSection.description}
    items={articles}
    viewAllText={articlesSection.viewAllText}
    viewAllUrl={articlesSection.viewAllUrl}
    columns="3"
    backgroundColor="bg-base-100"
    showArrow={true}
  />
  <VerifiedSection />
  <FAQ />
</Layout>
