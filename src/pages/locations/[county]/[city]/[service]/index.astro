---
import Layout from "../../../../../layouts/Layout.astro";
import PageHero from "../../../../../components/PageHero.astro";
import Button from "../../../../../components/Button.astro";

// Generate static paths - currently returns empty array
// TODO: Populate with actual county/city/service combinations
export async function getStaticPaths() {
  // Return empty array for now - this route is not yet populated
  // In production, you would query your data source to generate all valid combinations
  return [];
}

// For now, we'll use static mock data
// In production, you'd fetch this based on params
const { county, city, service } = Astro.params;

// Mock data - in production, fetch based on params
const pageData = {
  county: "West Midlands",
  countySlug: "west-midlands",
  city: "Birmingham",
  citySlug: "birmingham",
  service: "uPVC Door Repairs",
  serviceSlug: "upvc-repairs",
  description:
    "Find vetted locksmiths in Birmingham specializing in multipoint lock adjustment, gearbox replacement, and door alignment. All listed providers serve the Birmingham area (8 postcodes) and carry verified credentials.",
  postcodeCount: 8,
};

const seoData = {
  title: `${pageData.service} in ${pageData.city} | UK Locksmith Directory`,
  description: pageData.description,
};

// Service overview content
const serviceOverview = {
  title: "What uPVC repair involves",
  description:
    "uPVC repair focuses on the mechanism rather than the door structure itself. Specialists in Birmingham typically address issues caused by temperature fluctuation or general wear. A standard service call includes:",
  items: [
    {
      title: "Multipoint Gearbox Replacement",
      description:
        "Swapping the central mechanism when the spindle drive fails.",
    },
    {
      title: "Toe and Heeling (Alignment)",
      description:
        "Adjusting the door within the frame to stop catching or dragging.",
    },
    {
      title: "Handle & Cylinder Upgrades",
      description: "Replacing loose handles or upgrading to anti-snap locks.",
    },
  ],
  infoBox: {
    title: "Scheduled vs. Emergency Service",
    description:
      "Most uPVC repairs are scheduled services. However, if your door is jammed shut or cannot be locked securely, this is classified as an Emergency Callout.",
  },
};

// Providers offering this service
const providers = [
  {
    number: 1,
    name: "Brum City Security",
    badges: ["Verified", "DBS Checked"],
    rating: 5.0,
    reviewCount: 184,
    description:
      "Specialist in Yale, Era, and Fuhr mechanisms. We carry stock for 90% of uPVC doors in Birmingham, allowing for same-day repairs.",
    coverage: "Serves Birmingham City Centre, Edgbaston, Harborne",
    phone: "0121-XXX-XXXX",
    profileUrl: "/listings/brum-city-security",
  },
  {
    number: 2,
    name: "Midlands Master Locksmiths",
    badges: ["MLA Approved", "12 Mo Warranty"],
    rating: 4.8,
    reviewCount: 92,
    description:
      'Family-run business focusing on composite and uPVC door alignment. We offer a "No Fix, No Fee" policy on all mechanism replacements.',
    coverage: "Serves Sutton Coldfield, Erdington, Perry Barr",
    phone: "0121-XXX-XXXX",
    profileUrl: "/listings/midlands-master-locksmiths",
  },
  {
    number: 3,
    name: "Rapid Response B3",
    badges: ["Local Expert"],
    rating: 4.7,
    reviewCount: 12,
    description:
      "Specializing in emergency uPVC failures. If your door won't open or lock, we provide non-destructive entry and same-day mechanism replacement.",
    coverage: "Serves Jewellery Quarter, Digbeth, Moseley",
    phone: "0121-XXX-XXXX",
    profileUrl: "/listings/rapid-response-b3",
  },
];

// Pricing data
const pricing = [
  {
    serviceType: "Door Realignment (Toe & Heel)",
    lowEst: "£65",
    avgEst: "£85",
    highEst: "£110",
  },
  {
    serviceType: "Gearbox Replacement (Part inc.)",
    lowEst: "£130",
    avgEst: "£160",
    highEst: "£220",
  },
  {
    serviceType: "Full Mechanism Strip/Renewal",
    lowEst: "£180",
    avgEst: "£240",
    highEst: "£300+",
  },
];

// Other services in this city
const otherServices = [
  {
    title: "Snap-Safe Cylinders",
    description: "Upgrade to anti-snap barrels",
    linkUrl: `/locations/${pageData.countySlug}/${pageData.citySlug}/cylinder-upgrades`,
  },
  {
    title: "Window Lock Repairs",
    description: "Fix stuck hinges and handle fixes",
    linkUrl: `/locations/${pageData.countySlug}/${pageData.citySlug}/window-lock-repair`,
  },
  {
    title: "Emergency Locksmiths",
    description: "24/7 lockout assistance",
    linkUrl: `/locations/${pageData.countySlug}/${pageData.citySlug}/emergency-lockouts`,
  },
];
---

<Layout {...seoData}>
  <Header />

  <main class="bg-base-50">
    <div class="mx-auto max-w-7xl px-4 sm:px-6">
      <!-- Hero Section -->
      <PageHero
        title={`${pageData.service} in ${pageData.city}`}
        description={pageData.description}>
        <!-- CTA Buttons -->
        <div class="flex flex-wrap gap-4">
          <Button href="#providers" variant="primary" size="lg">
            See locksmiths offering {pageData.service.toLowerCase()}
          </Button>
          <Button href="/contact" variant="outline" size="lg">
            Request {pageData.service.toLowerCase()} quotes
          </Button>
        </div>
      </PageHero>

      <!-- Service Overview Section -->
      <section class="mb-16">
        <div
          class="mb-6 inline-block rounded-md bg-base-200/50 px-4 py-1.5 text-xs font-bold uppercase tracking-wide text-base-content/60">
          Service Overview
        </div>

        <h2 class="mb-6 text-2xl font-bold text-primary">
          {serviceOverview.title}
        </h2>

        <p class="mb-6 leading-relaxed text-base-content/70">
          {serviceOverview.description}
        </p>

        <!-- Service Items List -->
        <ul class="mb-8 space-y-3">
          {
            serviceOverview.items.map((item) => (
              <li class="flex gap-3">
                <div class="flex-shrink-0">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="mt-0.5 text-success">
                    <path d="M20 6 9 17l-5-5" />
                  </svg>
                </div>
                <div>
                  <div class="font-bold text-base-content">{item.title}:</div>
                  <div class="text-sm text-base-content/70">
                    {item.description}
                  </div>
                </div>
              </li>
            ))
          }
        </ul>

        <!-- Info Box -->
        <div
          class="rounded-lg border border-base-200 bg-base-100 p-6 shadow-sm">
          <div class="mb-2 font-bold text-base-content">
            {serviceOverview.infoBox.title}
          </div>
          <p class="text-sm leading-relaxed text-base-content/70">
            {serviceOverview.infoBox.description}
          </p>
        </div>
      </section>

      <!-- Providers List Section -->
      <section id="providers" class="mb-16">
        <div class="mb-6 flex items-center justify-between">
          <h2 class="text-2xl font-bold text-primary">
            Locksmiths offering {pageData.service} in {pageData.city}
          </h2>
          <span
            class="rounded-full bg-success/10 px-3 py-1 text-xs font-semibold text-success">
            Updated Today
          </span>
        </div>

        <div class="space-y-6">
          {
            providers.map((provider) => (
              <div class="relative flex flex-col gap-6 rounded-lg border border-base-200 bg-white p-6 shadow-sm md:flex-row">
                {/* Number Badge */}
                <div class="absolute right-6 top-6 flex size-12 items-center justify-center rounded-full bg-base-100 text-2xl font-bold text-base-content/20">
                  {provider.number.toString().padStart(2, "0")}
                </div>

                <div class="flex-1">
                  {/* Name */}
                  <h3 class="mb-3 text-xl font-bold text-primary">
                    {provider.name}
                  </h3>

                  {/* Badges */}
                  <div class="mb-3 flex flex-wrap gap-2">
                    {provider.badges.map((badge) => (
                      <span class="rounded bg-primary/10 px-2.5 py-1 text-xs font-semibold uppercase text-primary">
                        {badge}
                      </span>
                    ))}
                  </div>

                  {/* Rating */}
                  <div class="mb-4 flex items-center gap-3 text-sm">
                    <div class="flex items-center gap-1.5">
                      {Array.from({ length: 5 }, (_, i) => (
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          viewBox="0 0 24 24"
                          fill={i < provider.rating ? "currentColor" : "none"}
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          class={
                            i < provider.rating
                              ? "text-secondary"
                              : "text-base-300"
                          }>
                          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                        </svg>
                      ))}
                      <span class="ml-1 font-semibold text-base-content">
                        {provider.rating.toFixed(1)}
                      </span>
                      <span class="text-base-content/60">
                        ({provider.reviewCount} Reviews)
                      </span>
                    </div>
                  </div>

                  {/* Description */}
                  <p class="mb-4 text-sm leading-relaxed text-base-content/80">
                    {provider.description}
                  </p>

                  {/* Coverage */}
                  <div class="flex items-center gap-2 text-sm text-base-content/60">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="size-4">
                      <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                      <circle cx="12" cy="10" r="3" />
                    </svg>
                    <span>{provider.coverage}</span>
                  </div>
                </div>

                {/* Action Buttons */}
                <div class="flex flex-col justify-center gap-3 border-t border-base-200 pt-6 md:w-48 md:flex-shrink-0 md:border-l md:border-t-0 md:pt-0 md:pl-6">
                  <Button
                    href={provider.profileUrl}
                    variant="outline"
                    size="md"
                    fullWidth={true}>
                    View Details
                  </Button>
                  <Button
                    href={`tel:${provider.phone}`}
                    variant="primary"
                    size="md"
                    fullWidth={true}
                    iconLeft="icon-[tabler--phone]">
                    Call Now
                  </Button>
                </div>
              </div>
            ))
          }
        </div>
      </section>

      <!-- Pricing Section -->
      <section class="mb-16">
        <h2 class="mb-6 text-2xl font-bold text-primary">
          Pricing and what to expect
        </h2>

        <div class="overflow-x-auto rounded-lg border border-base-200 bg-white">
          <table class="w-full text-left">
            <thead class="border-b border-base-200 bg-base-50">
              <tr>
                <th class="px-6 py-4 text-sm font-bold text-base-content"
                  >Service Type</th
                >
                <th
                  class="px-6 py-4 text-right text-sm font-bold text-base-content"
                  >Low Est.</th
                >
                <th
                  class="px-6 py-4 text-right text-sm font-bold text-base-content"
                  >Avg Est.</th
                >
                <th
                  class="px-6 py-4 text-right text-sm font-bold text-base-content"
                  >High Est.</th
                >
              </tr>
            </thead>
            <tbody>
              {
                pricing.map((row, index) => (
                  <tr
                    class={
                      index !== pricing.length - 1
                        ? "border-b border-base-200"
                        : ""
                    }>
                    <td class="px-6 py-4 text-sm text-base-content/70">
                      {row.serviceType}
                    </td>
                    <td class="px-6 py-4 text-right text-sm font-medium text-base-content">
                      {row.lowEst}
                    </td>
                    <td class="px-6 py-4 text-right text-sm font-medium text-base-content">
                      {row.avgEst}
                    </td>
                    <td class="px-6 py-4 text-right text-sm font-medium text-base-content">
                      {row.highEst}
                    </td>
                  </tr>
                ))
              }
            </tbody>
          </table>
        </div>

        <p class="mt-4 text-xs text-base-content/50">
          *Estimates quoted in Birmingham. Costs may linked on brand e.g. Fuhr,
          Raco, Locksmiths' door age, and time of day. Parts priced inclusive
          typically.
        </p>
      </section>

      <!-- Other Services in This City -->
      <section class="mb-16">
        <h2 class="mb-6 text-2xl font-bold text-primary">
          Other locksmith services in {pageData.city}
        </h2>

        <div class="grid gap-6 md:grid-cols-3">
          {
            otherServices.map((service) => (
              <a
                href={service.linkUrl}
                class="group rounded-lg border border-base-200 bg-white p-6 shadow-sm transition-all hover:-translate-y-1 hover:shadow-md">
                <h3 class="mb-2 text-lg font-bold text-primary group-hover:underline">
                  {service.title}
                </h3>
                <p class="mb-4 text-sm text-base-content/70">
                  {service.description}
                </p>
                <div class="inline-flex items-center gap-1 text-sm font-semibold text-primary">
                  Learn more
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="size-4 transition-transform group-hover:translate-x-0.5">
                    <path d="M5 12h14" />
                    <path d="m12 5 7 7-7 7" />
                  </svg>
                </div>
              </a>
            ))
          }
        </div>
      </section>

      <!-- Final Navigation Section -->
      <section class="mb-16 text-center">
        <h2 class="mb-4 text-2xl font-bold text-primary">Explore more</h2>
        <div class="flex flex-col justify-center gap-4 sm:flex-row">
          <Button
            href={`/locations/${pageData.countySlug}/${pageData.citySlug}`}
            variant="outline"
            size="md"
            iconLeft="icon-[tabler--arrow-left]">
            Back to {pageData.city} locksmiths
          </Button>
          <Button
            href="/trust"
            variant="outline"
            size="md"
            iconRight="icon-[tabler--arrow-right]">
            Trust & Verification
          </Button>
        </div>
      </section>
    </div>
  </main>

  <Footer />
</Layout>
