---
import Layout from "../../../layouts/Layout.astro";
import PageHero from "../../../components/PageHero.astro";
import Button from "../../../components/Button.astro";
import Card from "../../../components/Card.astro";
import FAQ from "../../../components/FAQ.astro";
import { getAllCountySlugs, getCountyData } from "../../../data/locations/counties";
import { getCitiesByCounty } from "../../../data/locations/index";

// Generate static paths for all counties
export async function getStaticPaths() {
  const slugs = getAllCountySlugs();
  return slugs.map((slug) => ({
    params: { county: slug },
  }));
}

// Get the county data
const { county: countySlug } = Astro.params;
const countyData = getCountyData(countySlug);

// 404 if county not found
if (!countyData) {
  return Astro.redirect("/404");
}

// Get cities in this county
const cities = getCitiesByCounty(countySlug);

const seoData = {
  title: `Locksmiths in ${countyData.name} | UK Locksmith Directory`,
  description: countyData.description,
};

// Breadcrumbs
const breadcrumbs = [
  { label: "Home", href: "/" },
  { label: "Locations", href: "/locations" },
  { label: countyData.name, href: `/locations/${countySlug}` },
];
---

<Layout {...seoData}>
  <div class="bg-base-50">
    <div class="mx-auto max-w-7xl px-4 sm:px-6">
      <!-- Breadcrumbs -->
      <nav aria-label="Breadcrumb" class="py-4">
        <ol class="flex items-center gap-2 text-sm text-base-content/60">
          {
            breadcrumbs.map((crumb, index) => (
              <li class="flex items-center gap-2">
                {index < breadcrumbs.length - 1 ? (
                  <a href={crumb.href} class="hover:text-primary">
                    {crumb.label}
                  </a>
                ) : (
                  <span aria-current="page" class="text-base-content">
                    {crumb.label}
                  </span>
                )}
                {index < breadcrumbs.length - 1 && (
                  <span aria-hidden="true">/</span>
                )}
              </li>
            ))
          }
        </ol>
      </nav>

      <!-- Hero Section -->
      <PageHero
        title={`Locksmiths in ${countyData.name}`}
        description={countyData.description}>
        <!-- Stats -->
        <div class="mb-6 flex flex-wrap gap-6 text-sm">
          <div class="flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-primary">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span class="font-semibold text-primary">{countyData.prosCount} verified locksmiths</span>
          </div>
          <div class="flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-primary">
              <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span class="text-base-content/70">{countyData.towns.length} cities covered</span>
          </div>
        </div>

        <!-- CTA Buttons -->
        <div class="flex flex-wrap gap-4">
          <Button href="/search" variant="primary" size="lg">
            Search locksmiths in {countyData.name}
          </Button>
          <Button href="/emergency" variant="outline" size="lg">
            Emergency help
          </Button>
        </div>
      </PageHero>

      <!-- Cities Grid -->
      <section class="mb-16">
        <div class="mb-6 flex items-center justify-between">
          <h2 class="text-2xl font-bold text-primary">
            Towns & Cities in {countyData.name}
          </h2>
          <span class="text-sm text-base-content/60">
            {countyData.towns.length} locations
          </span>
        </div>

        <ul class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {
            countyData.towns.map((town, index) => (
              <Card
                variant="location"
                number={(index + 1).toString().padStart(2, "0")}
                title={town.name}
                prosCount={`${town.prosCount}+ locksmiths`}
                description={`Find verified locksmiths serving ${town.name} and surrounding areas.`}
                linkUrl={`/locations/${countySlug}/${town.slug}`}
                linkText="View locksmiths â†’"
              />
            ))
          }
        </ul>
      </section>

      <!-- Services Section -->
      <section class="mb-16">
        <h2 class="mb-6 text-2xl font-bold text-primary">
          Locksmith Services in {countyData.name}
        </h2>

        <div class="grid gap-6 md:grid-cols-2">
          {
            countyData.services.map((service) => (
              <a
                href={`/services/${service.slug}`}
                class="group flex gap-4 rounded-lg border border-base-200 bg-white p-6 transition-all hover:border-primary hover:shadow-md">
                <div class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                  </svg>
                </div>
                <div class="flex-1">
                  <h3 class="mb-1 font-bold text-primary group-hover:underline">
                    {service.title}
                  </h3>
                  <p class="text-sm text-base-content/70">
                    {service.description}
                  </p>
                </div>
                <div class="flex items-center">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="text-base-content/40 transition-transform group-hover:translate-x-1 group-hover:text-primary">
                    <path d="M5 12h14"></path>
                    <path d="m12 5 7 7-7 7"></path>
                  </svg>
                </div>
              </a>
            ))
          }
        </div>
      </section>

      <!-- Related Articles -->
      {
        countyData.articles.length > 0 && (
          <section class="mb-16">
            <h2 class="mb-6 text-2xl font-bold text-primary">
              Helpful Articles for {countyData.name}
            </h2>

            <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              {countyData.articles.map((article) => (
                <a
                  href={article.linkUrl}
                  class="group rounded-lg border border-base-200 bg-white p-6 transition-all hover:border-primary hover:shadow-md">
                  <span class="mb-2 inline-block rounded bg-base-100 px-2 py-1 text-xs font-semibold uppercase text-primary">
                    {article.category}
                  </span>
                  <h3 class="mb-2 font-bold text-primary group-hover:underline">
                    {article.title}
                  </h3>
                  <p class="text-sm text-base-content/70">{article.description}</p>
                </a>
              ))}
            </div>
          </section>
        )
      }

      <!-- FAQ Section -->
      {
        countyData.faqs.length > 0 && (
          <FAQ 
            faqs={countyData.faqs} 
            backgroundColor="bg-white" 
            showCTA={false} 
          />
        )
      }

      <!-- Back Navigation -->
      <section class="pb-16 text-center">
        <Button
          href="/locations"
          variant="outline"
          size="md"
          iconLeft="icon-[tabler--arrow-left]">
          Back to all locations
        </Button>
      </section>
    </div>
  </div>
</Layout>
