---
import Layout from "../../layouts/Layout.astro";
import PageHero from "../../components/PageHero.astro";
import Button from "../../components/Button.astro";
import Card from "../../components/Card.astro";
import FAQ from "../../components/FAQ.astro";

// Import from data layer (CMS-ready)
import { westMidlandsData } from "../../data/locations/counties";

// All data comes from the data layer - no inline content!
const countyData = westMidlandsData;

const seoData = {
  title: `Locksmiths in ${countyData.name} | UK Locksmith Directory`,
  description: `Find verified locksmiths across ${countyData.name}. ${countyData.prosCount} covering Birmingham, Coventry, Wolverhampton and surrounding areas.`,
};

// Transform towns for Card component
const townCards = countyData.towns.map((town, index) => ({
  variant: "location" as const,
  number: (index + 1).toString().padStart(2, "0"),
  title: town.name,
  prosCount: `${town.prosCount}+ PROS`,
  description: `Find verified locksmiths in ${town.name}`,
  linkUrl: `/locations/west-midlands/${town.slug}`,
  linkText: "View locksmiths →",
}));

// Transform services for cards
const serviceCards = countyData.services.map((service) => ({
  variant: "service" as const,
  title: service.title,
  description: service.description,
  linkUrl: `/services/${service.slug}`,
  linkText: "Learn more →",
}));

// Transform articles for cards
const articleCards = countyData.articles.map((article) => ({
  variant: "article" as const,
  category: article.category,
  title: article.title,
  description: article.description,
  linkUrl: article.linkUrl,
  linkText: "Read guide →",
  image: "/article-placeholder.png",
  imageAlt: article.title,
}));
---

<Layout {...seoData}>
  <div class="bg-base-50 py-16">
    <div class="mx-auto max-w-7xl px-4 sm:px-6">
      <!-- Hero Section -->
      <PageHero
        title={`Locksmiths in ${countyData.name}`}
        description={countyData.description}>
        <div class="flex flex-col gap-4 sm:flex-row sm:items-center">
          <Button
            href="#towns"
            variant="primary"
            size="md"
            iconRight="icon-[tabler--arrow-down]">
            Browse locksmiths by town
          </Button>
          <a
            href="/emergency"
            class="text-sm font-semibold text-primary hover:underline">
            Emergency locksmith help →
          </a>
        </div>
      </PageHero>

      <!-- Trust / Stats Strip -->
      <section class="mb-16">
        <div
          class="flex flex-wrap items-center justify-center gap-6 rounded-lg border border-base-200 bg-white px-8 py-6 shadow-sm md:gap-12">
          <div class="flex items-center gap-2 text-sm text-base-content/70">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-success">
              <path d="M20 6 9 17l-5-5"></path>
            </svg>
            <span>{countyData.prosCount} in {countyData.name}</span>
          </div>
          <div class="flex items-center gap-2 text-sm text-base-content/70">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-success">
              <path d="M20 6 9 17l-5-5"></path>
            </svg>
            <span>Identity verified</span>
          </div>
          <div class="flex items-center gap-2 text-sm text-base-content/70">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-success">
              <path d="M20 6 9 17l-5-5"></path>
            </svg>
            <span>24/7 emergency cover</span>
          </div>
        </div>
      </section>

      <!-- Locksmiths by Town -->
      <section id="towns" class="mb-16">
        <h2 class="mb-8 text-2xl font-bold text-primary">
          Locksmiths by Town in {countyData.name}
        </h2>

        <div class="mb-8">
          <details class="group mb-4" open>
            <summary
              class="flex cursor-pointer items-center justify-between rounded-lg border border-base-200 bg-white px-6 py-4 font-bold text-base-content transition-colors hover:bg-base-50">
              <span>{countyData.region}</span>
              <svg
                class="h-5 w-5 transition-transform group-open:rotate-180"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="mt-4 grid gap-4 md:grid-cols-2 lg:grid-cols-3">
              {townCards.map((town) => <Card {...town} />)}
            </div>
          </details>
        </div>
      </section>

      <!-- Locksmith Services -->
      <section class="mb-16">
        <h2 class="mb-8 text-2xl font-bold text-primary">
          Locksmith services available across {countyData.name}
        </h2>
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-4">
          {serviceCards.map((service) => <Card {...service} />)}
        </div>
      </section>

      <!-- Security & Advice -->
      <section class="mb-16">
        <h2 class="mb-8 text-2xl font-bold text-primary">
          Security & advice for {countyData.name} residents
        </h2>
        <div class="grid gap-6 md:grid-cols-3">
          {articleCards.map((article) => <Card {...article} />)}
        </div>
      </section>

      <!-- FAQ Section -->
      <FAQ
        title={`FAQs about locksmiths in ${countyData.name}`}
        faqs={countyData.faqs}
        backgroundColor="bg-base-50"
        showCTA={false}
      />

      <!-- Final CTA Section -->
      <section class="mt-16 text-center">
        <h2 class="mb-4 text-2xl font-bold text-primary">
          Need a locksmith urgently?
        </h2>
        <div class="flex flex-col justify-center gap-4 sm:flex-row">
          <Button
            href="/emergency"
            variant="primary"
            size="lg"
            iconLeft="icon-[tabler--phone]">
            24/7 Emergency Help
          </Button>
          <Button
            href="/search"
            variant="outline"
            size="lg"
            iconLeft="icon-[tabler--search]">
            Search by Postcode
          </Button>
        </div>
        <p class="mt-6 text-sm text-base-content/60">
          <a href="/trust" class="font-semibold text-primary hover:underline">
            How we verify locksmiths →
          </a>
        </p>
      </section>
    </div>
  </div>
</Layout>
