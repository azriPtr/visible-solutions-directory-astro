---


import Layout from "../../../layouts/Layout.astro";
import PageHero from "../../../components/PageHero.astro";
import Button from "../../../components/Button.astro";
import { getServiceBySlug, getAllServiceSlugs } from "../../../data/services/details";

// Generate static paths for all services
export async function getStaticPaths() {
  const slugs = getAllServiceSlugs();
  return slugs.map((slug) => ({
    params: { service: slug },
  }));
}

// Get the service data
const { service: serviceSlug } = Astro.params;
const serviceData = getServiceBySlug(serviceSlug);

// 404 if service not found
if (!serviceData) {
  return Astro.redirect("/404");
}

const seoData = {
  title: `${serviceData.title} | UK Locksmith Directory`,
  description: serviceData.metaDescription,
};

// Helper to get icon SVG based on type
function getSymptomIcon(iconType: string) {
  switch (iconType) {
    case "circle":
      return `<path d="M12 22c5.5 0 10-4.5 10-10S17.5 2 12 2 2 6.5 2 12s4.5 10 10 10z"></path>`;
    case "wrench":
      return `<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>`;
    case "door":
      return `<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><circle cx="12" cy="15" r="1"></circle>`;
    case "alert":
      return `<circle cx="12" cy="12" r="10"></circle><line x1="12" x2="12" y1="8" y2="12"></line><line x1="12" x2="12.01" y1="16" y2="16"></line>`;
    default:
      return `<circle cx="12" cy="12" r="10"></circle>`;
  }
}
---

<Layout {...seoData}>
  <Header />

  <main class="bg-base-50">
    <div class="mx-auto max-w-4xl px-4 sm:px-6">
      <!-- Hero Section -->
      <PageHero
        title={serviceData.title}
        description={serviceData.description}
      />

      <!-- Main Content -->
      <article class="pb-16">
        <!-- The Fundamentals Section -->
        <section class="mb-16">
          <div
            class="mb-6 inline-block rounded-md bg-base-200/50 px-4 py-1.5 text-xs font-bold uppercase tracking-wide text-base-content/60">
            The Fundamentals
          </div>

          <!-- What is this service? -->
          <div class="mb-12">
            <h2 class="mb-6 text-2xl font-bold text-primary">
              {serviceData.introTitle}
            </h2>
            <div class="space-y-4 text-base leading-relaxed text-base-content/70">
              {serviceData.introContent.map((paragraph) => <p>{paragraph}</p>)}
            </div>
          </div>

          <!-- When is this service needed? -->
          <div>
            <h2 class="mb-6 text-2xl font-bold text-primary">
              {serviceData.symptomsTitle}
            </h2>

            <div class="grid gap-6 md:grid-cols-3">
              {
                serviceData.symptoms.map((symptom) => (
                  <div class="rounded-lg border border-base-200 bg-white p-6 transition-shadow hover:shadow-md">
                    <div class="mb-4 flex items-center gap-3">
                      <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="20"
                          height="20"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          class="text-primary"
                          set:html={getSymptomIcon(symptom.icon)}
                        />
                      </div>
                      <h3 class="font-bold text-base-content">
                        {symptom.title}
                      </h3>
                    </div>
                    <p class="text-sm leading-relaxed text-base-content/70">
                      {symptom.description}
                    </p>
                  </div>
                ))
              }
            </div>
          </div>
        </section>

        <!-- Technical Factors Section -->
        <section class="mb-16">
          <div
            class="mb-6 inline-block rounded-md bg-base-200/50 px-4 py-1.5 text-xs font-bold uppercase tracking-wide text-base-content/60">
            Technical Factors
          </div>

          <h2 class="mb-6 text-2xl font-bold text-primary">
            {serviceData.factorsTitle}
          </h2>

          <p class="mb-6 leading-relaxed text-base-content/70">
            {serviceData.factorsIntro}
          </p>

          <!-- Accordion/Details for factors -->
          <div class="space-y-4">
            {
              serviceData.factors.map((factor) => (
                <details class="group rounded-lg border border-base-200 bg-white p-6 shadow-sm transition-shadow hover:shadow-md">
                  <summary class="flex cursor-pointer items-center justify-between font-bold text-base-content">
                    <span>{factor.title}</span>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="transition-transform group-open:rotate-180">
                      <path d="m6 9 6 6 6-6" />
                    </svg>
                  </summary>
                  <div class="mt-4 text-sm leading-relaxed text-base-content/70">
                    {factor.content}
                  </div>
                </details>
              ))
            }
          </div>
        </section>

        <!-- Professional vs DIY Section -->
        <section class="mb-16">
          <div
            class="rounded-lg border border-base-200 bg-base-100 p-8 shadow-sm">
            <div class="mb-4 flex items-center gap-3">
              <div
                class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="text-primary">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M12 16v-4"></path>
                  <path d="M12 8h.01"></path>
                </svg>
              </div>
              <h2 class="text-xl font-bold text-primary">
                {serviceData.professionalBox.title}
              </h2>
            </div>

            <p class="mb-6 leading-relaxed text-base-content/70">
              {serviceData.professionalBox.intro}
            </p>

            <ul class="space-y-4">
              {
                serviceData.professionalBox.points.map((point) => (
                  <li class="flex gap-3">
                    <div class="flex-shrink-0">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="mt-0.5 text-primary">
                        <path d="M20 6 9 17l-5-5" />
                      </svg>
                    </div>
                    <div>
                      <div class="mb-1 font-bold text-base-content">
                        {point.title}:
                      </div>
                      <div class="text-sm leading-relaxed text-base-content/70">
                        {point.description}
                      </div>
                    </div>
                  </li>
                ))
              }
            </ul>
          </div>
        </section>

        <!-- Find Specialists CTA -->
        <section class="mb-16 text-center">
          <div
            class="rounded-lg border border-base-200 bg-white p-12 shadow-sm">
            <h2 class="mb-4 text-3xl font-bold text-primary">
              {serviceData.ctaTitle}
            </h2>
            <p class="mb-8 text-base-content/70">
              {serviceData.ctaDescription}
            </p>
            <Button
              href={serviceData.ctaSearchUrl}
              variant="primary"
              size="lg"
              iconRight="icon-[tabler--arrow-right]">
              {serviceData.ctaButtonText}
            </Button>
          </div>
        </section>

        <!-- Internal Linking Sections -->
        <div class="grid gap-8 md:grid-cols-2">
          <!-- Popular Locations -->
          <section>
            <div
              class="mb-4 text-xs font-bold uppercase tracking-wide text-base-content/60">
              Popular Locations
            </div>
            <ul class="space-y-3">
              {
                serviceData.popularLocations.map((location) => (
                  <li>
                    <a
                      href={location.href}
                      class="flex items-center gap-2 text-sm font-semibold text-primary transition-colors hover:underline">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="flex-shrink-0">
                        <path d="M5 12h14" />
                        <path d="m12 5 7 7-7 7" />
                      </svg>
                      {location.label}
                    </a>
                  </li>
                ))
              }
            </ul>
          </section>

          <!-- Related Services -->
          <section>
            <div
              class="mb-4 text-xs font-bold uppercase tracking-wide text-base-content/60">
              Related Services
            </div>
            <ul class="space-y-3">
              {
                serviceData.relatedServices.map((service) => (
                  <li>
                    <a
                      href={service.href}
                      class="flex items-center gap-2 text-sm font-semibold text-primary transition-colors hover:underline">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="flex-shrink-0">
                        <path d="M5 12h14" />
                        <path d="m12 5 7 7-7 7" />
                      </svg>
                      {service.label}
                    </a>
                  </li>
                ))
              }
            </ul>
          </section>
        </div>
      </article>
    </div>
  </main>

  <Footer />
</Layout>
